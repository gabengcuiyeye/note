**遇到问题**：消息OA保存草稿，json格式化内存占用过大，考虑如何优化？

1.为什么json序列化后体积变大

json格式化会增加key，引号，冒号，花括号等的存储，将其他非字符串内容以字符串的形式存储。如下图：

![image-20201207170025822](../image/image-20201207170025822.png)

对比计算下序列化前后体积大小：

```js
var test = { a: 1, b: false, c: undefined, d: null }//4字节==》不确定
```
json序列化后：（默认使用UTF-8的编码方式计算）

```js
"{"a":1,"b":false,"d":null}"//26字节(不算前后括号)
```



**解决办法**：是否可以不用json序列化也可以反解析回来？

1.序列化的几种方式

二进制序列化：原始Value 内存的直接拷贝

文本序列化：value（int/bool等）转为字符串存储

二进制序列化协议为了压缩空间，一般不存储字段名（无法自解释）， 而是通过 tag标识对应。

自解释：可以根据反序列化的内容，不依赖其他信息，还原原始的对象。

传输双方依据一个相同的idl文件，生成对应的序列化反序列化方法。

网上有没有现成的库可用？https://msgpack.org/

2.如何反序列化

根据存储信息反解析回原数据

3.自定义序列化(代码)

若是key已知，可以自定义一个map存储key，存储时根据map还原回来。比如，若是已知对象固定的key为：a,b,c，可以建立一个映射

var map ={a:1,b:2,c:3}
